rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Interview video uploads — allow unauthenticated writes for token-mode candidates
    // Read restricted to org members via custom claim
    match /{orgId}/candidates/{candidateId}/interviews/{sessionId}/{fileName} {
      allow write: if true;
      allow read: if request.auth != null && request.auth.token.orgId == orgId;
    }

    // Candidate files (resumes, thumbnails, intro videos)
    // Write: any authenticated user (for job applicants using anonymous auth)
    // Read: org members only
    match /{orgId}/candidates/{candidateId}/{allPaths=**} {
      allow write: if request.auth != null;
      allow read: if request.auth != null && request.auth.token.orgId == orgId;
    }

    // Org-level files (branding assets, logos) — public read, org write
    match /{orgId}/branding/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.orgId == orgId;
    }

    // Deny everything else by default
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
